# JEPA-WMS (codebase) AGENTS KB

**Generated:** 2026-01-27 (UTC)
**Branch:** main
**Commit:** 8b44d5a

PyTorch world-model training + planning evaluation. Config-driven (`--fname <yaml>`).

## Structure
```
jepa-wms/
├── app/                  # training apps + shared plan_common
├── evals/                # eval runners + planning/unroll suites
├── src/                  # core library (models/datasets/utils)
├── configs/              # training configs + eval templates + example eval configs
├── tests/                # pytest runner; tests are unittest-style
├── hubconf.py            # torch.hub entrypoints (pretrained model loading)
├── setup_macros.py       # generates macros.py from JEPAWM_* env vars
└── macros.py             # generated; DO NOT COMMIT
```

## Where to look
| Task | Location | Notes |
|------|----------|-------|
| Train (local) | `app/main.py` | `--debug` = single-process |
| Train (SLURM) | `app/main_distributed.py` | submitit; snapshots repo to `<folder>/code/` |
| Eval (local) | `evals/main.py` | |
| Eval (SLURM) | `evals/main_distributed.py` | `--copy_code` optional |
| Planning eval suite | `evals/simu_env_planning/` | envs + planners + metrics |
| World model training loop | `app/vjepa_wm/train.py` | monolithic; triggers eval jobs |
| World model wrapper | `app/vjepa_wm/video_wm.py` | encode/unroll/rollout logic |
| Config env-var expansion | `src/utils/yaml_utils.py` | expands `${VAR}` placeholders |
| Dataset path resolution | `src/utils/cluster.py`, `src/datasets/utils/utils.py` | needs `JEPAWM_DSET` |
| Most central utility | `src/utils/logging.py` | imported widely |

## Commands
Run from `jepa-wms/`.

```bash
# Install (per README)
conda create -n jepa-wms python=3.10 ffmpeg=7 -c conda-forge -y
conda activate jepa-wms
uv pip install -e .
uv pip install -e ".[dev]"  # optional

# Tests
pytest tests

# Lint (CI scope)
python -m isort app/*.py evals/*.py src tests --check
python -m flake8 --config .flake8 --show-source --statistics app/*.py evals/*.py src tests
python -m black --check app/*.py evals/*.py src tests
```

## Conventions / gotchas
- Python version is pinned: `>=3.10,<3.11` (`pyproject.toml`).
- Line length is **119** across black/isort/flake8.
- `setup_macros.py` writes `macros.py` and exits if required env vars are missing.
- Configs use `${JEPAWM_LOGS}` / `${JEPAWM_DSET}` / `${JEPAWM_CKPT}` / `${JEPAWM_OSSCKPT}`.
- Generated/ignored config outputs:
  - `configs/dump_online_evals/**` (generated by training) — don’t hand-edit
  - `configs/cwtemp/**` (generated by eval-grid tool) — don’t commit

## Anti-patterns (this project)
- **DO NOT COMMIT** `macros.py` (generated header says so).
- Avoid adding imports from `app/` or `evals/` into `src/` (keep `src` as foundation layer).

## Subdirectory guides
- `app/AGENTS.md`
- `evals/AGENTS.md`
- `src/AGENTS.md`
- `configs/AGENTS.md`
- `tests/AGENTS.md`
